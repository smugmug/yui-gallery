<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src&#x2F;sm-editor&#x2F;js&#x2F;editor-base.js - SmugMug YUI Gallery API docs</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="SmugMug YUI Gallery API docs"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 3.9.0-git</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/Editor.html">Editor</a></li>
            
                <li><a href="..&#x2F;classes/Editor.Base.html">Editor.Base</a></li>
            
                <li><a href="..&#x2F;classes/Editor.Keys.html">Editor.Keys</a></li>
            
                <li><a href="..&#x2F;classes/Editor.Undo.html">Editor.Undo</a></li>
            
                <li><a href="..&#x2F;classes/Menu.html">Menu</a></li>
            
                <li><a href="..&#x2F;classes/Menu.Base.html">Menu.Base</a></li>
            
                <li><a href="..&#x2F;classes/Menu.Item.html">Menu.Item</a></li>
            
                <li><a href="..&#x2F;classes/Menu.Templates.html">Menu.Templates</a></li>
            
                <li><a href="..&#x2F;classes/Plugin.FocusManager.html">Plugin.FocusManager</a></li>
            
                <li><a href="..&#x2F;classes/Plugin.Menu.html">Plugin.Menu</a></li>
            
                <li><a href="..&#x2F;classes/Range.html">Range</a></li>
            
                <li><a href="..&#x2F;classes/Selection.html">Selection</a></li>
            
                <li><a href="..&#x2F;classes/TreeView.html">TreeView</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/gallery-sm-editor.html">gallery-sm-editor</a></li>
            
                <li><a href="..&#x2F;modules/gallery-sm-editor-base.html">gallery-sm-editor-base</a></li>
            
                <li><a href="..&#x2F;modules/gallery-sm-editor-keys.html">gallery-sm-editor-keys</a></li>
            
                <li><a href="..&#x2F;modules/gallery-sm-editor-undo.html">gallery-sm-editor-undo</a></li>
            
                <li><a href="..&#x2F;modules/gallery-sm-focusmanager.html">gallery-sm-focusmanager</a></li>
            
                <li><a href="..&#x2F;modules/gallery-sm-menu.html">gallery-sm-menu</a></li>
            
                <li><a href="..&#x2F;modules/gallery-sm-menu-base.html">gallery-sm-menu-base</a></li>
            
                <li><a href="..&#x2F;modules/gallery-sm-menu-item.html">gallery-sm-menu-item</a></li>
            
                <li><a href="..&#x2F;modules/gallery-sm-menu-plugin.html">gallery-sm-menu-plugin</a></li>
            
                <li><a href="..&#x2F;modules/gallery-sm-menu-templates.html">gallery-sm-menu-templates</a></li>
            
                <li><a href="..&#x2F;modules/gallery-sm-range.html">gallery-sm-range</a></li>
            
                <li><a href="..&#x2F;modules/gallery-sm-selection.html">gallery-sm-selection</a></li>
            
                <li><a href="..&#x2F;modules/gallery-sm-treeview.html">gallery-sm-treeview</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src&#x2F;sm-editor&#x2F;js&#x2F;editor-base.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;*jshint expr:true, onevar:false *&#x2F;

Y.Node.DOM_EVENTS.paste = 1;

&#x2F;**
Provides &#x60;Y.Editor.Base&#x60;, the core implementation of the SmugMug editor.

@module gallery-sm-editor
@submodule gallery-sm-editor-base
**&#x2F;

&#x2F;**
Base implementation of the SmugMug editor. Provides core editor functionality,
but no undo stack, keyboard shortcuts, etc.

@class Editor.Base
@constructor
@extends View
**&#x2F;

var doc          = Y.config.doc,
    getClassName = Y.ClassNameManager.getClassName;

&#x2F;**
Fired after this editor loses focus.

@event blur
**&#x2F;
var EVT_BLUR = &#x27;blur&#x27;;

&#x2F;**
Fired after this editor receives focus.

@event focus
**&#x2F;
var EVT_FOCUS = &#x27;focus&#x27;;

&#x2F;**
Fired after this editor is rendered.

@event render
**&#x2F;
var EVT_RENDER = &#x27;render&#x27;;

&#x2F;**
Fired when this editor&#x27;s selection changes.

@event selectionChange
@param {Range} prevRange Range that was previously selected, or &#x60;null&#x60; if there
    was no previous selection.
@param {Range} range Range that&#x27;s now selected, or &#x60;null&#x60; if the current
    selection is empty or outside the editor.
@param {Selection} selection Reference to this editor&#x27;s Selection instance.
**&#x2F;
var EVT_SELECTION_CHANGE = &#x27;selectionChange&#x27;;

var EditorBase = Y.Base.create(&#x27;editorBase&#x27;, Y.View, [], {
    &#x2F;&#x2F; -- Public Properties ----------------------------------------------------

    &#x2F;**
    CSS class names used by this editor.

    @property {Object} classNames
    @param {String} cursor Class name used for a placeholder node that
        represents the cursor position.
    @param {String} editor Class name used for the editor&#x27;s container.
    @param {String} input Class name used for the WYSIWYG YUI Editor frame that
        will receive user input.
    **&#x2F;
    classNames: {
        cursor: getClassName(&#x27;sm-editor-cursor&#x27;, true),
        editor: getClassName(&#x27;sm-editor&#x27;, true),
        input : getClassName(&#x27;sm-editor-input&#x27;, true)
    },

    &#x2F;**
    &#x60;Y.Selection&#x60; instance representing the current document selection.

    The selection object&#x27;s state always reflects the current selection, so it
    will update when the selection changes. If you need to retain the state of a
    past selection, hold onto a Range instance representing that selection.

    Also, beware: this selection object reflects the current selection in the
    entire browser document, not just within this editor.

    @property {Selection} selection
    **&#x2F;

    &#x2F;**
    Hash of style commands supported by this editor.

    Names should correspond with valid &#x60;execCommand()&#x60; command names. Values
    should be strings specifying the style&#x27;s type: either &#x27;boolean&#x27; or &#x27;string&#x27;.

    @property {Object} styleCommands
    @param {String} [bold=&#x27;boolean&#x27;]
    @param {String} [italic=&#x27;boolean&#x27;]
    @param {String} [fontName=&#x27;string&#x27;]
    @param {String} [fontSize=&#x27;string&#x27;]
    @param {String} [underline=&#x27;string&#x27;]
    **&#x2F;
    styleCommands: {
        bold     : &#x27;boolean&#x27;,
        italic   : &#x27;boolean&#x27;,
        fontName : &#x27;string&#x27;,
        fontSize : &#x27;string&#x27;,
        underline: &#x27;boolean&#x27;
    },

    &#x2F;&#x2F; -- Protected Properties -------------------------------------------------

    &#x2F;&#x2F; -- Lifecycle ------------------------------------------------------------
    initializer: function () {
        this.selection  = new Y.Selection();
        this.selectors  = {};

        this._cursorHTML = &#x27;&lt;span class=&quot;&#x27; + this.classNames.cursor + &#x27;&quot;&gt;&lt;&#x2F;span&gt;&#x27;;

        Y.Object.each(this.classNames, function (name, key) {
            this.selectors[key] = &#x27;.&#x27; + name;
        }, this);

        this._attachEvents();
    },

    destructor: function () {
        this._detachEvents();

        this.selection = null;
    },

    &#x2F;&#x2F; -- Public Methods -------------------------------------------------------

    &#x2F;**
    Removes focus from this editor.

    @method blur
    @chainable
    **&#x2F;
    blur: function () {
        if (this._inputNode) {
            this._inputNode.blur();
        }

        return this;
    },

    &#x2F;**
    Bolds or unbolds the current selection.

    @method bold
    @chainable
    **&#x2F;
    bold: function () {
        this.style(&#x27;bold&#x27;, &#x27;toggle&#x27;);
        return this;
    },

    &#x2F;**
    Gets and&#x2F;or sets the value of the specified editor command.

    See &lt;https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;Rich-Text_Editing_in_Mozilla&gt;
    for a list of possible commands.

    @method command
    @param {String} name Command name.
    @param {Boolean|String|null} [value] Command value. Use the special value
        &#x27;toggle&#x27; to toggle a boolean command (like &#x27;bold&#x27;) to the opposite of
        its current state.
    @return {Boolean|String} Value of the specified command.
    **&#x2F;
    command: function (name, value) {
        if (typeof value !== &#x27;undefined&#x27;) {
            this._execCommand(name, value);
        }

        return this._queryCommandValue(name);
    },

    &#x2F;**
    Decreases the font size of the current selection (if possible).

    @method decreaseFontSize
    @chainable
    **&#x2F;
    decreaseFontSize: function () {
        var newSize = parseInt(this.style(&#x27;fontSize&#x27;), 10) - 1;

        if (newSize &gt; 0) {
            this.style(&#x27;fontSize&#x27;, &#x27;&#x27; + newSize);
        }

        return this;
    },

    &#x2F;**
    Focuses this editor.

    @method focus
    @chainable
    **&#x2F;
    focus: function () {
        if (this._inputNode) {
            this._inputNode.focus();
        }

        return this;
    },

    &#x2F;**
    Increases the font size of the current selection (if possible).

    @method increaseFontSize
    @chainable
    **&#x2F;
    increaseFontSize: function () {
        var newSize = parseInt(this.style(&#x27;fontSize&#x27;), 10) + 1;

        if (newSize &lt; 8) {
            this.style(&#x27;fontSize&#x27;, &#x27;&#x27; + newSize);
        }

        return this;
    },

    &#x2F;**
    Inserts the specified _html_ at the current selection point, deleting the
    current selection if there is one.

    @method insertHTML
    @param {HTML|HTMLElement|Node} html HTML to insert, in the form of an HTML
        string, HTMLElement, or Node instance.
    @return {Node} Node instance representing the inserted HTML.
    **&#x2F;
    insertHTML: function (html) {
        var node      = typeof html === &#x27;string&#x27; ? Y.Node.create(html) : html,
            selection = this.selection,
            range     = selection.range();

        if (!range) {
            return;
        }

        node = range.deleteContents().insertNode(node);
        range.collapse();

        selection.select(range);

        return node;
    },

    &#x2F;**
    Inserts the specified plain _text_ at the current selection point, deleting
    the current selection if there is one.

    @method insertText
    @param {String} text Text to insert.
    @return {Node} Node instance representing the inserted text node.
    **&#x2F;
    insertText: function (text) {
        return this.insertHTML(doc.createTextNode(text));
    },

    &#x2F;**
    Italicizes or unitalicizes the current selection.

    @method italic
    @chainable
    **&#x2F;
    italic: function () {
        this.style(&#x27;italic&#x27;, &#x27;toggle&#x27;);
        return this;
    },

    &#x2F;**
    Renders this editor into its container and appends the container to the
    document if necessary.

    @method render
    @chainable
    **&#x2F;
    render: function () {
        var container  = this.get(&#x27;container&#x27;),
            inputNode  = container.one(this.selectors.input);

        container.addClass(this.classNames.editor);

        if (!inputNode) {
            inputNode = container.appendChild(&#x27;&lt;div&#x2F;&gt;&#x27;)
                                 .addClass(this.classNames.input);
        }

        var html = this.get(&#x27;html&#x27;),
            text = this.get(&#x27;text&#x27;);

        if (html) {
            inputNode.setHTML(html);
        } else if (text) {
            inputNode.set(&#x27;text&#x27;, text);
        }

        inputNode.set(&#x27;contentEditable&#x27;, true);
        doc.execCommand(&#x27;styleWithCSS&#x27;, false, &#x27;true&#x27;);

        this._inputNode = inputNode;
        this._rendered  = true;

        this._updateSelection({silent: true});

        this.fire(EVT_RENDER);

        return this;
    },

    &#x2F;**
    Gets and&#x2F;or sets the value of the specified editor style command. This
    method is similar to &#x60;command()&#x60;, but only supports a subset of
    style-related commands.

    See the &#x60;styleCommands&#x60; property for a list of supported style commands.

    @method style
    @param {String} name Command name.
    @param {Boolean|String} [value] Command value. Use the special value
        &#x27;toggle&#x27; to toggle a boolean command (like &#x27;bold&#x27;) to the opposite of
        its current state.
    @return {Boolean|String} Value of the specified command.
    **&#x2F;
    style: function (name, value) {
        if (!this.styleCommands.hasOwnProperty(name)) {
            Y.error(&#x27;sm-editor: Unsupported style: &#x27; + name);
            return;
        }

        return this.command(name, value);
    },

    &#x2F;**
    Gets and&#x2F;or sets the values of multiple editor style commands.

    When called without an argument, the current values of all supported style
    commands will be returned. When called with a _styles_ object, the specified
    style commands will be set to their given values, and the resulting new
    values will be returned.

    @method styles
    @param {Object} [styles] Hash of style names and values to set.
    @return {Object} Hash of style names and values that were set, or all styles
        if no _styles_ parameter was specified.
    **&#x2F;
    styles: function (styles) {
        var results = {},
            name;

        if (styles) {
            for (name in styles) {
                if (styles.hasOwnProperty(name)) {
                    results[name] = this.style(name, styles[name]);
                }
            }
        } else {
            var commands = this.styleCommands;

            for (name in commands) {
                if (commands.hasOwnProperty(name)) {
                    results[name] = this._queryCommandValue(name);
                }
            }
        }

        return results;
    },

    &#x2F;**
    Toggles underline on the current selection.

    @method underline
    @chainable
    **&#x2F;
    underline: function () {
        this.style(&#x27;underline&#x27;, &#x27;toggle&#x27;);
        return this;
    },

    &#x2F;&#x2F; -- Protected Methods ----------------------------------------------------

    &#x2F;**
    Attaches editor events.

    @method _attachEvents
    @protected
    **&#x2F;
    _attachEvents: function () {
        if (this._events) {
            return;
        }

        var container = this.get(&#x27;container&#x27;),
            selectors = this.selectors;

        this._events = [
            container.delegate(&#x27;blur&#x27;,  this._onBlur,  selectors.input, this),
            container.delegate(&#x27;focus&#x27;, this._onFocus, selectors.input, this),
            container.delegate(&#x27;paste&#x27;, this._onPaste, selectors.input, this)
        ];
    },

    &#x2F;**
    Detaches editor events.

    @method _detachEvents
    @protected
    **&#x2F;
    _detachEvents: function () {
        if (this._events) {
            new Y.EventHandle(this._events).detach();
            this._events = null;
        }
    },

    &#x2F;**
    Wrapper for native the native &#x60;execCommand()&#x60; that verifies that the command
    is valid in the current state and normalizes boolean&#x2F;toggleable values.

    @method _execCommand
    @param {String} name Command name.
    @param {Boolean|String} value Command value.
    @protected
    **&#x2F;
    _execCommand: function (name, value) {
        var type = this.styleCommands[name];

        if (!doc.queryCommandEnabled(name)) {
            Y.log(&#x27;Command is not currently allowed: &#x27; + name, &#x27;warn&#x27;, &#x27;sm-editor&#x27;);
            return;
        }

        if (type === &#x27;boolean&#x27;) {
            &#x2F;&#x2F; Only execute the command if the desired state differs from the
            &#x2F;&#x2F; current state, or the desired state is &#x27;toggle&#x27;, indicating that
            &#x2F;&#x2F; the command should be toggled regardless of its current state.
            if (value === &#x27;toggle&#x27; || value !== this._queryCommandValue(name)) {
                doc.execCommand(name, false, null);
            }
        } else {
            doc.execCommand(name, false, value);
        }
    },

    &#x2F;**
    Getter for the &#x60;html&#x60; attribute.

    @method _getHTML
    @param {HTML} value Internal value.
    @return {HTML} HTML.
    @protected
    **&#x2F;
    _getHTML: function (value) {
        return this._rendered ? this._inputNode.getHTML() : value;
    },

    &#x2F;**
    Getter for the &#x60;text&#x60; attribute.

    @method _getText
    @param {String} value Internal value.
    @return {String} Text.
    @protected
    **&#x2F;
    _getText: function (value) {
        return this._rendered ? this._inputNode.get(&#x27;text&#x27;) : value;
    },

    &#x2F;**
    Inserts a &#x60;&lt;span&gt;&#x60; at the current selection point containing a preformatted
    tab character.

    @method _insertTab
    @protected
    **&#x2F;
    _insertTab: function () {
        this.insertHTML(&#x27;&lt;span style=&quot;white-space:pre;&quot;&gt;\t&lt;&#x2F;span&gt;&#x27;);
    },

    &#x2F;**
    Wrapper for the native &#x60;queryCommandState()&#x60; and &#x60;queryCommandValue()&#x60;
    methods that uses the appropriate method for the given command type.

    @method _queryCommandValue
    @param {String} name Command name.
    @return {Boolean|String} Command value.
    @protected
    **&#x2F;
    _queryCommandValue: function (name) {
        return this.styleCommands[name] === &#x27;boolean&#x27; ?
            !!doc.queryCommandState(name) : doc.queryCommandValue(name);
    },

    &#x2F;**
    Setter for the &#x60;html&#x60; attribute.

    @method _setHTML
    @param {HTML} value HTML.
    @return {HTML} HTML.
    @protected
    **&#x2F;
    _setHTML: function (value) {
        if (this._rendered) {
            this._inputNode.setHTML(value);
        }

        return value;
    },

    &#x2F;**
    Setter for the &#x60;text&#x60; attribute.

    @method _setText
    @param {String} value Text.
    @return {String} Text.
    @protected
    **&#x2F;
    _setText: function (value) {
        if (this._rendered) {
            this._inputNode.set(&#x27;text&#x27;, value);
        }

        return value;
    },

    &#x2F;**
    Refreshes the editor&#x27;s internal knowledge of the current document selection
    state and fires a &#x60;selectionChange&#x60; event if the selection has changed since
    it was last refreshed.

    @method _updateSelection
    @param {Object} [options] Options.
        @param {Boolean} [options.silent=false] If &#x60;true&#x60;, the &#x60;selectionChange&#x60;
            event will be suppressed.
    @protected
    **&#x2F;
    _updateSelection:  function (options) {
        var prevRange = this._selectedRange || null,
            newRange  = this.selection.range() || null,
            silent    = options &amp;&amp; options.silent;

        if (newRange === prevRange || (prevRange &amp;&amp; prevRange.isEquivalent(newRange))) {
            return;
        }

        this._selectedRange = newRange;

        &#x2F;&#x2F; Only fire an event if options.silent is falsy and the new range is
        &#x2F;&#x2F; either null or is entirely inside this editor.
        if (!silent &amp;&amp; (!newRange || newRange.isInsideNode(this._inputNode))) {
            this.fire(EVT_SELECTION_CHANGE, {
                prevRange: prevRange,
                range    : newRange,
                selection: this.selection
            });
        }
    },

    &#x2F;&#x2F; -- Protected Event Handlers ---------------------------------------------

    &#x2F;**
    Handles &#x60;blur&#x60; events on the editor.

    @method _onBlur
    @protected
    **&#x2F;
    _onBlur: function () {
        if (!this._rendered) {
            return;
        }

        clearInterval(this._selectionMonitor);
        this._updateSelection();

        this.fire(EVT_BLUR);
    },

    &#x2F;**
    Handles &#x60;focus&#x60; events on the editor.

    @method _onFocus
    @protected
    **&#x2F;
    _onFocus: function () {
        var self = this;

        if (!this._rendered) {
            return;
        }

        this._updateSelection();

        clearInterval(this._selectionMonitor);

        this._selectionMonitor = setInterval(function () {
            self._updateSelection();
        }, 200);

        this.fire(EVT_FOCUS);
    },

    &#x2F;**
    Handles &#x60;paste&#x60; events on the editor.

    @method _onPaste
    @protected
    **&#x2F;
    _onPaste: function () {
        &#x2F;&#x2F; TODO: handle paste events!
    }
}, {
    ATTRS: {
        &#x2F;**
        HTML content of this editor.

        @attribute {HTML} html
        @default &#x27;&#x27;
        **&#x2F;
        html: {
            getter: &#x27;_getHTML&#x27;,
            setter: &#x27;_setHTML&#x27;,
            value : &#x27;&#x27;
        },

        &#x2F;**
        Form field name to use for the hidden &#x60;&lt;textarea&gt;&#x60; that contains the raw
        output of the editor in the configured output format. This name will
        only be used if the output node doesn&#x27;t already have a name when the
        editor is rendered.

        You may need to customize this if you plan to use the editor in a form
        that will be submitted to a server.

        @attribute {String} outputName
        @default &#x27;editor&#x27;
        @initOnly
        **&#x2F;
        outputName: {
            value    : &#x27;editor&#x27;,
            writeOnce: &#x27;initOnly&#x27;
        },

        &#x2F;**
        Text content of this editor, with no HTML.

        @attribute {String} text
        @default &#x27;&#x27;
        **&#x2F;
        text: {
            getter: &#x27;_getText&#x27;,
            setter: &#x27;_setText&#x27;,
            value : &#x27;&#x27;
        }
    }
});

Y.namespace(&#x27;Editor&#x27;).Base = EditorBase;

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
